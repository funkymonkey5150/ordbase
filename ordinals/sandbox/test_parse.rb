require 'json'
require 'nokogiri'


html =<<HTML
<!doctype html>
<html lang=en>
  <head>
    <meta charset=utf-8>
    <meta name=format-detection content='telephone=no'>
    <meta name=viewport content='width=device-width,initial-scale=1.0'>
    <meta property=og:title content='Inscription 46051102'>
    <meta property=og:image content='https://balance.ordinals.net/static/favicon.png'>
    <meta property=twitter:card content=summary>
    <title>Inscription 46051102</title>
    <link rel=alternate href=/feed.xml type=application/rss+xml title='Inscription RSS Feed'>
    <link rel=stylesheet href=/static/index.css>
    <link rel=stylesheet href=/static/modern-normalize.css>
    <script src=/static/index.js defer></script>
  </head>
  <body>
  <header>
    <nav>
      <a href=/ title=home>Ordinals<sup>alpha</sup></a>
      <a href=/inscriptions title=inscriptions><img class=icon src=/static/images.svg></a>
      <a href=/collections title=collections><img class=icon src=/static/diagram-project.svg></a>
      <a href=/blocks title=blocks><img class=icon src=/static/cubes.svg></a>
      <a href=/clock title=clock><img class=icon src=/static/clock.svg></a>
      <a href=/rare.txt title=rare><img class=icon src=/static/gem.svg></a>
      <a href=https://docs.ordinals.com/ title=handbook><img class=icon src=/static/book.svg></a>
      <a href=https://github.com/ordinals/ord title=github><img class=icon src=/static/github.svg></a>
      <a href=https://discord.com/invite/ordinals title=discord><img class=icon src=/static/discord.svg></a>
      <form action=/search method=get>
        <input type=text autocapitalize=off autocomplete=off autocorrect=off name=query spellcheck=false>
        <input class=icon type=image src=/static/magnifying-glass.svg alt=Search>
      </form>
    </nav>
  </header>
  <main>
<h1>Inscription 46051102</h1>
<div class=inscription>
<a class=prev href=/inscription/643dcc8dbdf2dbb554164db63d79556834edc34da1f7c47c660f44ab28125df9i0>❮</a>
<iframe sandbox=allow-scripts scrolling=no loading=lazy src=/preview/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9i0></iframe>
<a class=next href=/inscription/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9i1>❯</a>
</div>
<dl>
  <dt>id</dt>
  <dd class=monospace>6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9i0</dd>
  <dt>address</dt>
  <dd class=monospace>bc1pkdqs4ksyha8n2ugxtyywku35pwmv7t60yrru0f860aaf3u5faujq9a6hmc</dd>
  <dt>output value</dt>
  <dd>1000</dd>
  <dt>sat</dt>
  <dd><a href=/sat/1855843827094534>1855843827094534</a></dd>
  <dt>preview</dt>
  <dd><a href=/preview/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9i0>link</a></dd>
  <dt>content</dt>
  <dd><a href=/content/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9i0>link</a></dd>
  <dt>content length</dt>
  <dd>299 bytes</dd>
  <dt>content type</dt>
  <dd>image/png</dd>
  <dt>timestamp</dt>
  <dd><time>2023-12-04 13:55:36 UTC</time></dd>
  <dt>genesis height</dt>
  <dd><a href=/block/819753>819753</a></dd>
  <dt>genesis fee</dt>
  <dd>8580</dd>
  <dt>genesis transaction</dt>
  <dd><a class=monospace href=/tx/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9>6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9</a></dd>
  <dt>location</dt>
  <dd class=monospace>6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9:0:0</dd>
  <dt>output</dt>
  <dd><a class=monospace href=/output/6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9:0>6a4c8233c4d3e032ef1d57c3581533a1d4ab5ae21b1140f4f87394d89896b4f9:0</a></dd>
  <dt>offset</dt>
  <dd>0</dd>
  <dt>ethereum teleburn address</dt>
  <dd>0xCC74AdD15f8AdF44425C5875f5D0Ddfc5754f11d</dd>
</dl>

  </main>
  </body>
</html>
HTML



html_v0 =<<HTML
<!doctype html>
<html lang=en>
  <head>
    <meta charset=utf-8>
    <meta name=format-detection content='telephone=no'>
    <meta name=viewport content='width=device-width,initial-scale=1.0'>
    <meta property=og:title content='Inscription 407'>
    <meta property=og:image content='https://ordinals.net/static/favicon.png'>
    <meta property=twitter:card content=summary>
    <title>Inscription 407</title>
    <link rel=alternate href=/feed.xml type=application/rss+xml title='Inscription RSS Feed'>
    <link rel=stylesheet href=/static/index.css>
    <link rel=stylesheet href=/static/modern-normalize.css>
    <script src=/static/index.js defer></script>
  </head>
  <body>
  <header>
    <nav>
      <a href=/>Ordinals<sup>alpha</sup></a>
      <a href=https://docs.ordinals.com/>Handbook</a>
      <a href=https://github.com/casey/ord>Wallet</a>
      <a href=/clock>Clock</a>
      <a href=/rare.txt>rare.txt</a>
      <form action=/search method=get>
        <input type=text autocapitalize=off autocomplete=off autocorrect=off name=query spellcheck=false>
        <input type=submit value=Search>
      </form>
    </nav>
  </header>
  <main>
<h1>Inscription 407</h1>
<div class=inscription>
<a class=prev href=/inscription/f3247c255e78a659b52ac08572d1c02ccd1390b69a06c65848aafaeaf0799f40i0>❮</a>
<iframe sandbox=allow-scripts scrolling=no loading=lazy src=/preview/acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37i0></iframe>
<a class=next href=/inscription/fdb0ba70f4989a33a8bb2b5284b264ef23c17ed7389fdd606ecf134e8af7b9edi0>❯</a>
</div>
<dl>
  <dt>id</dt>
  <dd class=monospace>acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37i0</dd>
  <dt>address</dt>
  <dd class=monospace>bc1qx3scwushtwenxtxlnjet4x2w5vg35etdtse5u0</dd>
  <dt>output value</dt>
  <dd>8020</dd>
  <dt>sat</dt>
  <dd><a href=/sat/1883186433806857>1883186433806857</a></dd>
  <dt>preview</dt>
  <dd><a href=/preview/acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37i0>link</a></dd>
  <dt>content</dt>
  <dd><a href=/content/acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37i0>link</a></dd>
  <dt>content length</dt>
  <dd>529 bytes</dd>
  <dt>content type</dt>
  <dd>image/png</dd>
  <dt>timestamp</dt>
  <dd><time>2023-01-31 19:34:47 UTC</time></dd>
  <dt>genesis height</dt>
  <dd><a href=/block/774489>774489</a></dd>
  <dt>genesis fee</dt>
  <dd>5340</dd>
  <dt>genesis transaction</dt>
  <dd><a class=monospace href=/tx/acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37>acda637db995df796b35035fd978cc1a947f1e6fd5215968da88b7e38a7e4b37</a></dd>
  <dt>location</dt>
  <dd class=monospace>6630ff2153985504b180fc16721d559a4cecdc66f4be6acf33509ec2100c0aa5:0:0</dd>
  <dt>output</dt>
  <dd><a class=monospace href=/output/6630ff2153985504b180fc16721d559a4cecdc66f4be6acf33509ec2100c0aa5:0>6630ff2153985504b180fc16721d559a4cecdc66f4be6acf33509ec2100c0aa5:0</a></dd>
  <dt>offset</dt>
  <dd>0</dd>
</dl>

  </main>
  </body>
</html>
HTML


def parse_page( html )
  doc = Nokogiri::HTML( html )

  items = []

  title = doc.css( 'head title' )
  items << ['title', title.text]


  dls = doc.css( 'body dl' )
  dls[0].css( 'dt,dd' ).each do |el|
     if el.name == 'dt'
          items << [el.text]
     elsif el.name == 'dd'
          items[-1] << el.text
     else
       puts "!! ERROR - unexpected tag; expected dd|dl; got: #{el.name}"
       exit 1
     end
  end
  items

  ## convert to hash
  ##   and check for duplicate
  data = {}
  items.each do |k,v|
      k = k.strip
      v = v.strip
      if data.has_key?( k )
         puts "!! ERROR - duplicate key >#{k}< in:"
         pp items
         exit 1
      end
      data[ k ] = v
  end
  data
end


data =  parse_page( html )

## pp data

puts JSON.pretty_generate( data )


puts "bye"